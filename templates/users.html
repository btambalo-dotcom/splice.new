
{% extends 'base.html' %}
{% block title %}Usuários · SPLICER{% endblock %}
{% block content %}
<h3 class="mb-3">Usuários</h3>

<div class="row g-4">
  <div class="col-lg-5">
    <div class="card p-4">
      <h5 class="mb-3">Novo / editar usuário</h5>
      <form method="post">
        <div class="mb-3">
          <label class="form-label">Usuário (login)</label>
          <input class="form-control" name="username" required placeholder="Ex.: bruno">
          <div class="form-text">Se o usuário já existir, os dados serão atualizados.</div>
        </div>
        <div class="mb-3">
          <label class="form-label">Senha</label>
          <input class="form-control" type="password" name="password" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Nome do splicer</label>
          <input class="form-control" name="splicer_name" placeholder="Ex.: BRUNO TAMBALO">
          <div class="form-text">Esse nome aparece nos lançamentos como campo Splicer. Se vazio, será usado o login.</div>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" value="1" id="is_admin" name="is_admin">
          <label class="form-check-label" for="is_admin">
            Administrador (vê todos os registros, configura empresas e cria usuários)
          </label>
        </div>
        <button class="btn btn-primary w-100">Salvar usuário</button>
      </form>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="card p-4">
      <h5 class="mb-3">Lista de usuários</h5>
      <div class="table-responsive">
        <table class="table table-sm table-dark align-middle mb-0">
          <thead>
            <tr>
              <th>ID</th>
              <th>Usuário</th>
              <th>Splicer</th>
              <th>Admin?</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
              <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>{{ u.splicer_name or '-' }}</td>
                <td>
                  {% if u.is_admin %}
                    <span class="badge bg-warning text-dark">ADMIN</span>
                  {% else %}
                    <span class="badge bg-secondary">Normal</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  {% if u.username != 'admin' %}
                    <a href="{{ url_for('user_delete', uid=u.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remover este usuário?');">✕</a>
                  {% endif %}
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="5" class="text-center text-secondary">Nenhum usuário cadastrado além do admin.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
